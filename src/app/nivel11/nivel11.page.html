<ion-content>
  <div class="stars-bg"></div>

  <div class="header-section">
    <h1>NIVEL 11: FUGAS DE ENERGÍA</h1>
  </div>

  <div class="game-layout">

    <div class="panel left-panel">
      <div class="panel-header">SISTEMA DE ENERGÍA</div>
      <div class="panel-body">
        
        <div class="robot-scene">
          <img src="assets/robotfusion.png" alt="Reactor Core" onerror="this.src='assets/wbit_js_contact.png'">
        </div>
        
        <div class="story-box">
          <p>
            <strong style="color: #ff0055;">¡PELIGRO DE SOBRECARGA!</strong> 
            El núcleo del reactor está demasiado caliente (2000 GW).
            Necesitamos reducir la energía exactamente a <strong>1500 GW</strong>.
            <br><br>
             <strong>DATO CLAVE:</strong> En JavaScript, los números <strong>NO llevan comillas</strong> (ej: <code>2000</code>, no <code>"2000"</code>).
          </p>
        </div>

        <div class="syntax-card">
          <h4>MANUAL: MATEMÁTICAS JS</h4>
          
          <div class="comparison-row">
            <small>SUMAR (+)</small>
            <code class="new">let total = 100 + 50;</code>
          </div>

          <div class="comparison-row">
            <small>RESTAR (Usa espacios)</small>
            <code class="new">let resto = total <span style="color:#ff0055"> - </span> consumo;</code>
          </div>
          
          <div class="comparison-row">
            <small>MULTIPLICACIÓN (*)</small>
            <code>let doble = 10 * 2;</code>
          </div>
        </div>

        <div class="mission-guide">
          <h4>OBJETIVO DE MISIÓN</h4>
          <ol>
            <li>La energía actual es <strong>2000</strong>. (Crea <code>let reactor = 2000;</code>).</li>
            <li>Calcula mentalmente cuánto restar para llegar a 1500. (Crea <code>let escudos = ...;</code>).</li>
            <li>Crea una variable <code>final</code> restando: <br><code>reactor - escudos</code></li>
            <li>Muestra la variable <code>final</code> en consola.</li>
          </ol>
        </div>

      </div>
    </div>

    <div class="panel center-panel">
      <div class="panel-header">TERMINAL DE COMANDO (JS)</div>
      
      <div class="editor-container">
        <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10</div>
        
        <textarea 
          class="code-input" 
          [(ngModel)]="codigoUsuario" 
          spellcheck="false" 
          placeholder="// 1. Define reactor en 2000&#10;// 2. Define escudos (¿Cuánto necesitas restar?)&#10;// 3. Haz la resta (Usa espacios: a - b)&#10;// 4. Imprime el resultado">
        </textarea>
      </div>

      <button class="btn-compile" (click)="ejecutarCodigo()" [disabled]="nivelCompletado">
        ESTABILIZAR REACTOR
      </button>
    </div>

    <div class="panel right-panel">
      <div class="panel-header">NÚCLEO DEL REACTOR</div>
      <div class="panel-body centered-body">
        
        <div class="reactor-container" [class.stable]="nivelCompletado">
          <div class="core-energy"></div>
          <div class="reactor-ring"></div>
        </div>

        <div class="screen-output">
          <small>NIVEL DE ENERGÍA:</small>
          <div class="text-signal">
            {{ mensajeSistema || '2000 GW (PELIGRO)' }}
          </div>
        </div>

        <div class="system-logs">
          <div *ngFor="let log of consolaLogs" [class]="log.tipo">
            > {{ log.mensaje }}
          </div>
        </div>

        <button *ngIf="nivelCompletado" class="btn-next" (click)="guardarProgreso()">
          MISIÓN CUMPLIDA (+300 XP)
        </button>

      </div>
    </div>

  </div>
</ion-content>