<ion-content>
  <div class="stars-bg"></div>

  <div class="header-section">
    <h1>NIVEL 13: TÚNEL TÓXICO</h1>
  </div>

  <div class="game-layout">

    <div class="panel left-panel">
      <div class="panel-header">PROTOCOLO DE EMERGENCIA</div>
      <div class="panel-body">
        
        <div class="robot-scene">
          <img src="assets/robot-toxico.png" alt="Robot Túnel" onerror="this.src='assets/robot-toxico.png'">
        </div>
        
        <div class="story-box">
          <p>
            <strong style="color: #39ff14;">ALERTA DE RADIACIÓN:</strong><br>
            W-BIT ha entrado en un túnel oscuro. No sabemos qué tan largo es, pero el sensor detecta residuos tóxicos.
            <br><br>
            No podemos usar pasos fijos. Debemos avanzar <strong>MIENTRAS</strong> el sensor indique que el camino es "seguro".
          </p>
        </div>

        <div class="syntax-card">
          <h4>MANUAL: BUCLE WHILE (MIENTRAS)</h4>
          
          <div class="comparison-row success-style">
            <small>ESTRUCTURA CORRECTA:</small>
            <code class="new">while (sensor == "seguro") &#123;<br>  avanzar();<br>&#125;</code>
          </div>

          <div style="margin-top: 15px; border-top: 1px solid #333; padding-top: 10px;">
            <h4 style="font-size: 0.9rem; margin-bottom: 5px;"> DESGLOSE DE SIMBOLOGÍA:</h4>
            
            <div style="display: flex; align-items: center; margin-bottom: 5px;">
              <code style="color: #39ff14; background: #222; padding: 2px 5px; margin-right: 10px;">while</code>
              <small style="color: #aaa;">La orden de "Repetir".</small>
            </div>

            <div style="display: flex; align-items: center; margin-bottom: 5px;">
              <code style="color: #39ff14; background: #222; padding: 2px 5px; margin-right: 10px;">( ... )</code>
              <small style="color: #aaa;">La <strong>Pregunta</strong>.</small>
            </div>

            <div style="display: flex; align-items: center; margin-bottom: 5px;">
              <code style="color: #39ff14; background: #222; padding: 2px 5px; margin-right: 10px;">==</code>
              <small style="color: #aaa;">Comparación. ¿Es igual a?</small>
            </div>

            <div style="display: flex; align-items: center; margin-bottom: 5px;">
              <code style="color: #39ff14; background: #222; padding: 2px 5px; margin-right: 10px;">&#123; ... &#125;</code>
              <small style="color: #aaa;">La <strong>Acción</strong>. Lo que se repite.</small>
            </div>

            <div style="display: flex; align-items: center;">
              <code style="color: #39ff14; background: #222; padding: 2px 5px; margin-right: 10px;">;</code>
              <small style="color: #aaa;">El "Punto final" de la orden.</small>
            </div>
          </div>

        </div>

        <div class="mission-guide">
          <h4>OBJETIVO DE MISIÓN:</h4>
          <ol>
            <li>Crea: <code>let sensor = "seguro";</code></li>
            <li>Escribe la estructura:</li>
            <li><code>while (sensor == "seguro") &#123;</code></li>
            <li>Ordena avanzar: <code>avanzar();</code></li>
            <li>Cierra la llave: <code>&#125;</code></li>
          </ol>
        </div>

      </div>
    </div>

    <div class="panel center-panel">
      <div class="panel-header">TERMINAL DE CONTROL</div>
      <div class="editor-container">
        <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10</div>
        
        <textarea 
          class="code-input" 
          [(ngModel)]="codigoUsuario" 
          (focus)="limpiarTerminal()"
          spellcheck="false" 
          placeholder="// Escribe tu bucle while aquí..."></textarea>
      </div>

      <button class="btn-compile" (click)="ejecutarCodigo()" [disabled]="nivelCompletado">
        INICIAR SECUENCIA
      </button>
    </div>

    <div class="panel right-panel">
      <div class="panel-header">ESCÁNER DE TERRENO</div>
      <div class="panel-body centered-body">
        
        <div class="hologram-container" [class.active]="nivelCompletado">
          <div class="scan-line"></div>
          <div class="hologram-content">
             <ion-icon name="nuclear-outline" class="holo-icon"></ion-icon>
             <span *ngIf="!nivelCompletado">ESCANEO...</span>
             <span *ngIf="nivelCompletado" class="holo-text">SALIDA</span>
          </div>
        </div>

        <div class="screen-output">
          <small>ESTADO DEL MOTOR:</small>
          <div class="text-signal">
            {{ mensajeSistema || 'EN ESPERA...' }}
          </div>
        </div>

        <div class="system-logs">
          <div *ngFor="let log of consolaLogs" [class]="log.tipo">
            > {{ log.mensaje }}
          </div>
        </div>

        <button *ngIf="nivelCompletado" class="btn-next" (click)="guardarProgreso()">
          TÚNEL SUPERADO (+400 XP)
        </button>

      </div>
    </div>

  </div>
</ion-content>